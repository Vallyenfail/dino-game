"""
Задание 3.5: Добавление нового типа врага (Летучая мышь)

РЕШЕНИЕ ВЫПОЛНЕНО: Создан файл Bat.py в корне проекта

Чтобы добавить летучих мышей в игру, нужно:
1. ✅ Создать класс Bat (УЖЕ СОЗДАН: Bat.py)
2. Добавить загрузку спрайтов в images.py  
3. Добавить летучих мышей в игровой цикл game.py

================================================================================
ШАГ 1: СПРАЙТЫ ДЛЯ ЛЕТУЧЕЙ МЫШИ
================================================================================

ВАРИАНТ А: Использовать временно спрайты птиц (быстрое решение)
----------------------------------------------------------------
В images.py добавьте в конец файла:

# Загружаем летучих мышей (используем спрайты птиц временно)
bat_img = bird_img


ВАРИАНТ Б: Создать собственные спрайты
---------------------------------------
1. Создайте папку Bat/ в корне проекта
2. Добавьте туда 2-3 картинки: Bat1.png, Bat2.png, Bat3.png
3. В images.py добавьте:

# Загружаем летучих мышей
bat_img = [
    pygame.image.load('Bat/Bat1.png'),
    pygame.image.load('Bat/Bat2.png'),
    pygame.image.load('Bat/Bat3.png')
]

ГДЕ ВЗЯТЬ СПРАЙТЫ:
- OpenGameArt.org (поиск "bat sprite")
- itch.io/game-assets/free
- Нарисовать в Piskel.app (40x40 пикселей)


================================================================================
ШАГ 2: ДОБАВЛЕНИЕ ИМПОРТА В game.py
================================================================================

В начало файла game.py добавьте:

from Bat import *


================================================================================
ШАГ 3: СОЗДАНИЕ ЛЕТУЧИХ МЫШЕЙ В run_game()
================================================================================

Найдите в game.py метод run_game(), примерно строка 146-149:

    bird1 = Bird(-80)
    bird2 = Bird(-40)
    all_birds = [bird1, bird2]

ПОСЛЕ ЭТОГО КОДА добавьте:

    # НОВЫЙ КОД: Создаём летучих мышей
    bat1 = Bat()
    bat2 = Bat()
    all_bats = [bat1, bat2]


================================================================================
ШАГ 4: ДОБАВЛЕНИЕ В ИГРОВОЙ ЦИКЛ
================================================================================

Найдите в run_game() строки с отрисовкой птиц (примерно строка 224-225):

    self.draw_birds(all_birds)
    self.check_birds_dmg(all_mouse_bullets, all_birds)

ПОСЛЕ ЭТОГО КОДА добавьте:

    # НОВЫЙ КОД: Рисуем и обрабатываем летучих мышей
    self.draw_bats(all_bats, all_mouse_bullets)


================================================================================
ШАГ 5: ДОБАВЛЕНИЕ МЕТОДОВ В КЛАСС Game
================================================================================

В класс Game (в файле game.py) добавьте новый метод:
"""

def draw_bats(self, bats, bullets):
    """
    Рисует летучих мышей и обрабатывает взаимодействия
    
    Args:
        bats: Список летучих мышей
        bullets: Список пуль игрока
    """
    from images import bat_img
    
    for bat in bats:
        # Рисуем летучую мышь
        bat.draw(bat_img)
        
        # Двигаем зигзагом
        if not bat.move_zigzag():
            # Если улетела за край, возвращаем обратно
            bat.reset()
        
        # Проверяем попадания пуль
        bullets_to_remove = []
        for bullet in bullets:
            if bat.kill_bat(bullet):
                bullets_to_remove.append(bullet)
                # Добавляем очки за убийство
                self.scores += 5
                bat.reset()  # Возвращаем летучую мышь
                break
        
        # Удаляем попавшие пули
        for bullet in bullets_to_remove:
            if bullet in bullets:
                bullets.remove(bullet)
        
        # ОПЦИОНАЛЬНО: Проверка столкновения с игроком
        # if bat.check_collision_with_player(p.usr_x, p.usr_y, p.usr_width, p.usr_height):
        #     if not self.check_health():
        #         return False


"""
================================================================================
ПОЛНЫЙ КОД ДЛЯ КОПИРОВАНИЯ
================================================================================
"""

# 1. В images.py (в конец файла):
"""
# Летучие мыши (используем спрайты птиц временно)
bat_img = bird_img
"""

# 2. В game.py (в начало файла, после других импортов):
"""
from Bat import *
"""

# 3. В game.py, метод run_game() (после создания птиц):
"""
    bird1 = Bird(-80)
    bird2 = Bird(-40)
    all_birds = [bird1, bird2]
    
    # Создаём летучих мышей
    bat1 = Bat()
    bat2 = Bat()
    all_bats = [bat1, bat2]
"""

# 4. В game.py, игровой цикл (после draw_birds):
"""
    self.draw_birds(all_birds)
    self.check_birds_dmg(all_mouse_bullets, all_birds)
    
    # Рисуем летучих мышей
    self.draw_bats(all_bats, all_mouse_bullets)
"""

# 5. В game.py, класс Game (новый метод):
"""
    def draw_bats(self, bats, bullets):
        '''Рисует и обрабатывает летучих мышей'''
        from images import bat_img
        
        for bat in bats:
            bat.draw(bat_img)
            
            if not bat.move_zigzag():
                bat.reset()
            
            bullets_to_remove = []
            for bullet in bullets:
                if bat.kill_bat(bullet):
                    bullets_to_remove.append(bullet)
                    self.scores += 5
                    bat.reset()
                    break
            
            for bullet in bullets_to_remove:
                if bullet in bullets:
                    bullets.remove(bullet)
"""


"""
================================================================================
ОЖИДАЕМЫЙ РЕЗУЛЬТАТ
================================================================================

✅ Летучие мыши появляются справа и летят зигзагом влево
✅ Можно сбивать их пулями
✅ За убийство дают 5 очков
✅ После убийства или вылета за экран возвращаются обратно
✅ Не стреляют (проще чем птицы)

КАК ПРОВЕРИТЬ:
1. Примените все изменения
2. Запустите игру
3. Летучие мыши должны появиться и лететь зигзагом
4. Попробуйте сбить их - должны получить очки
5. Летучие мыши должны появляться снова после убийства

СОВЕТЫ ПО БАЛАНСУ:
- Если летучие мыши слишком быстрые: измените speed_x в Bat.py
- Если их слишком много: создавайте только одну (уберите bat2)
- Если сложно попасть: увеличьте self.width и self.height в Bat.py
"""
